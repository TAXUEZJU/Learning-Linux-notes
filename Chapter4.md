## Linux平台日常运维管理

#### 查看系统负载
* `w`  
第一行从左面开始显示的信息依次为：时间、系统运行时间、登录用户数、平均负载。  
第二行以下主要是显示当前登录的用户以及他们从何处登录，`JCPU`指的是和该终端连接的所有正在运行进程占用的时间，`PCPU`指当前进程所占用的时间
```
10:42:00 up 1 day,  1:09,  1 user,  load average: 0.59, 0.72, 0.67
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
taxue    pts/0    :0               二09    0.00s  0.08s  0.00s w
```
`load average`后面的三个数值依次表示１、５、15分钟内系统的平均负载值，这个值的意义是单位时间段内CPU活动进程数。一般情况下数值不超过CPU数量就没关系。
* `cat /proc/cpuinfo`可以查看CPU信息  
`grep -c 'processor' /proc/cpuinfo`可以查看CPU数量
* `uptime`也可以查看系统负载，显示的结果与`w`第一行一致

#### vmstat详解
* `vmstat 1`执行结果如下，其中参数`1`表示１秒显示一次，后面可以再加一个数字参数表示一共显示几次，比如`vmstat 1 5`就是１秒１次，显示５次
```
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 0  0 201812 663368     28 2809320    0    1    21    34   51   97  5  2 93  0  0
 0  0 201812 662360     28 2809896    0    0     0     0 1762 11263  5  1 93  1  0
 0  0 201812 663072     28 2809900    0    0     0     0 2415 9899  4  2 94  0  0
```
* `procs`显示进程相关信息  
`r`表示置于运行队列中的进程数目（包括正在执行和等待CPU的），如果长期大于CPU个数，说明CPU不够用  
`b`表示等待资源的进数。比如等待I/O、内存等，值如果长时间大于１，则需要关注
* `memroy`内存相关信息  
`swpd`表示切换到交换分区中内存数量  
`free`当前空闲的内存数量  
`buff`缓冲大小（即将写入磁盘）  
`cache`缓存大小（从磁盘中读取）
* `swap`内存交换情况  
`si`由交换区写入内存的数据量  
`so`由内存写入交换区的数据量
* `io`磁盘使用情况
`bi`从块设备读取数据的量（读磁盘）    
`bo`从块设备写入数据的量（写磁盘）
* `system`显示采集间隔内发生的中断次数  
`in`表示某一时间间隔中观测到的每秒中断数  
`cs`表示每秒产生的上下文切换次数
* `cpu`显示cpu的使用状态  
`us`显示用户进程执行时间百分比  
`sy`显示系统进程执行时间百分比  
`id`表示cpu处于空闲状态的时间百分比  
`wa`表示I/O等待所占用cpu时间百分比  
`st`标好似被偷走的cpu时间百分比（一般为０，不用关注）
* 通常关注`r`、`b`、`wa`。如果磁盘I/O压力很大时，`bi`与`bo`数值也会较高。当`si`与`so`较高并不断变化时，说明内存不够，内存中数据频繁交换到交换分区，对系统性能影响极大。

#### top动态查看负载
* `top`动态监控进程所占系统资源，每3秒变更一次，特点是将占用系统资源（CPU，内存，磁盘I/O）最高的进程放到最前面，`RES`为进程所占内存大小。
* `top`状态下，按`M`即`shift+m`可以按照内存使用大小排序，按数字`1`可以列出各cpu的使用状态
* `top -bn1`非动态打印系统资源使用情况，会一次性输出所有信息

#### sar命令
`sar`可以监控系统所有资源状态  
* `sar -n DEV`查看网卡流量，`-f`选项可以查看历史流量，后面跟文件名。Redhat和CentOS发行版`sar`的库文件一定是在`/var/log/sa/`目录下
* `ls /var/log/sa`会看到两种不同的文件，一个以`sa`开头加日期，一个以`sar`开头加日期，前一个只能用`sar -f`查看，后一种可以`cat`查看，它们都是记录的系统状态历史信息
* `sar -q`查看历史负载
* `sar`可以查看cpu情况，`-b`可以查看I/O情况等

#### free查看内存
* `free`执行结果如下  
```
total       used       free     shared    buffers     cached
Mem:       8072124    7163300     908824     497780         32    1857360
-/+ buffers/cache:    5305908    2766216
Swap:      8385532     435632    7949900
```
`-m`和`-g`参数可以分别以M或G为单位显示结果，其中`buffers`为缓冲，将分散的写操作集中进行，以减少反复寻道，提升系统性能。`cached`是将一部分读取过的内容保存，重新读取就不需命中硬盘，所以简单来说，前者是内存中写入磁盘的，后者是从磁盘中读取出的。
